---
title: "Домашнее задание №2"
author: "Adelya Galimova"
date: "2025-02-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, include=FALSE}
packageurl <- "https://cran.r-project.org/src/contrib/Archive/DiscriMiner/DiscriMiner_0.1-29.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(knitr)
library(kableExtra)
library(magrittr)
library(openxlsx)
library(ggplot2)
library(GGally)
library(ggpubr)
library(Hmisc)
library(corrplot)
library(ppcor)
library(DiscriMiner)
library(readxl)
library(pander)
library(xlsx)
```

## 1. Оцените корреляционную матрицу.
### Корреляционный анализ

```{r}
df <- read.xlsx('russian_regions.xlsx', sheetIndex = 2)
df$FEDERAL_OKRUG <- as.factor(df$FEDERAL_OKRUG)
df$REGION <- as.factor(df$REGION)
```

```{r, echo = FALSE}
desc <- read.xlsx('russian_regions.xlsx', sheetIndex = 1)
kbl(desc, caption = "Таблица 1. Описание данных", booktabs = T, 
    col.names = c("Переменная", "Описание переменной")) %>% 
  kable_classic_2(html_font = "Cambria", font_size = 10, full_width = F) %>%
  pack_rows("Зависимая переменная", 1, 1) %>%
  pack_rows("Уровень жизни", 2, 3) %>%
  pack_rows("Медицина", 4, 6) %>%
  pack_rows("Экология", 7, 8) %>%
  pack_rows("Рынок труда", 9, 17) %>%
  pack_rows("Прочее", 18, 18)
```

#### Рассчитаем корреляционную матрицу для количественных переменных:

```{r}
df2 <- df[2:18]
df3 <- cor(df2, method = 'pearson')
kbl(caption = "Таблица 1. Корреляционная матрица, метод Пирсона", df3, booktabs = T) %>% 
 kable_classic(html_font = "Cambria", font_size = 4.5, full_width = F) # Корреляционная матрица
```

#### Теперь выведем кусочек матрицы, включающий только интересующий нас столбец с ВРП
```{r}
df3[,3:3]
```

#### Для более удобного представления данных, отобразим матрицу на графике:
Корреляционная матрица:

```{r}
corrplot(as.matrix(df3), type = "full", method = "circle", tl.col = "black", tl.srt = 45, tl.cex = 0.5)
```

#### Теперь комбинируем оценку корреляционной матрицы с результатами тестов на значимость:

```{r}
res <- cor.mtest(df2, conf.level = 0.95)
corrplot(cor(df2), p.mat = res$p, sig.level = 0.05, tl.col = "black", tl.srt = 45, tl.cex = 0.5) 
```

## 2. Интерпретация полученных коэффициентов.

Проанализируем полученные значения коэффициентов корреляции между исследуемой переменной GRP и основными остальными переменными.

1) Корреляция между GRP и QOFLIFE_INDEX составляет 0.34439222, что указывает на умеренную положительную линейную связь. Это означает, что с увеличением ВРП наблюдается рост рейтинга качества жизни населения. Вероятное объяснение заключается в том, что увеличение производства в регионе приводит к большему объему денежных средств, которые используются для улучшения инфраструктуры и удовлетворения потребностей населения, что, в свою очередь, способствует повышению качества жизни.

2) Корреляция между GRP и AVERAGE_INCOME равна 0.83781385, что говорит о очень сильной положительной линейной связи. Это указывает на то, что с ростом ВРП увеличиваются среднедушевые денежные доходы населения. Чем выше ВРП, тем больше производится конечных товаров в регионе, что позволяет расширять производство и повышать зарплаты существующим работникам.

3) Корреляция между GRP и UNEMPLOYMENT_RATE составляет -0.35496867, что свидетельствует о умеренной отрицательной линейной связи. Это означает, что с увеличением ВРП уровень безработицы снижается. Рост производства создает больше рабочих мест, что позволяет обеспечить занятость большему числу людей.

4) Корреляция между GRP и EMPLOYMENT_RATE равна 0.45120108, что указывает на умеренную положительную линейную связь. Это означает, что с увеличением ВРП возрастает коэффициент занятости. Чем больше объем производства, тем больше требуется рабочей силы для его обеспечения.

## 3) Найти и интерпретировать коэффициент корреляционного отношения между переменными `WAGE_GENDER_GAP` и `FEM_WAGE`.

#### Для упрощения сначала разделим переменную заработной платы на две категории - высокую и низкую. В таблице у нас нет деления зарплаты на 2 категории, поэтому, чтобы сделать категории максимально равными, рассчитаем основные показатели по столбцу:

```{r}
summary(df[15])
```

####Для более ясного разделения будем использовать медиану, равную 31127. Первая категория будет состоять из женщин с зарплатой ниже 31127, а вторая — с зарплатой выше 31127.

```{r}
for (i in 1:length(df$FEM_WAGE)) {
  if (df$FEM_WAGE[i] <= 31127) {
    df[i, 18] <- "1"
  } else {
    df[i, 18] <- "2"
  }
}
colnames(df)[18] <- c('group')
table(df[18])
```
#### Далее рассчитаем коэффициент корреляционного отношения между переменными `WAGE_GENDER_GAP` и `FEM_WAGE`:

```{r}
corRatio(df$WAGE_GENDER_GAP, as.factor(df$group)) #eta_{WAGE_GENDER_GAP, FEM_WAGE}
pander(FRatio(df$WAGE_GENDER_GAP, as.factor(df$group)))
```

#### Мы можем заметить, что существует небольшая значимая корреляционная зависимость (чем ближе значение к 1, тем характернее зависимость) между гендерным разрывом в зарплате и зарплатой женщин. Другими словами, чем больше гендерный разрыв, тем выше зарплата женщин.