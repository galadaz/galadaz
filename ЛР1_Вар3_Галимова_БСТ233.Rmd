---
title: "Лабораторная работа по использованию R в статистических исследованиях"
author: "Галимова Аделя"
date: "2024-11-24"
output:
  html_document: default
  pdf_document: default
  word_document: default
---
## Лабораторная работа 
## Галимова Аделя
### 1.1.Импорт данных для работы 
Импортируем данные для выполнения типового расчета 
```{r} 
getwd()
setwd('C:\\Users\\evere\\Desktop\\matstat')
library('rio')
dataframe <- import('Данные по вариантам для выполнения типового расчета.xlsx') 
data <- dataframe['v3']
```
Найдем первые и последние 6 значений:
```{r}
head(data) # показывает первые шесть (по умолчанию) строк каждого столбца
```
```{r}
tail(data) # показывает последние шесть (по умолчанию) строк каждого столбца
```
Используем еще одну более информативную команду `str`, которая позволяет узнать класс объекта, в котором содержатся данные (в нашем случае `data.frame`), число наблюдений (`observations` - $101$) и столбцов-признаков (`variable` - $1$), а также тип данных каждого признака (указан после имени - `chr`) и первые четыре наблюдения:
```{r}
str(data)
```
Данные успешно импортированы. Теперь нужно привести их к виду, при котором мы сможем использовать функции статистического анализа R. 

### 1.2 Подготовка данных для статистического анализа
Можно заметить, что к нашим $100$ наблюдениям добавилось одно лишнее, которое было внизу столбца, и тип данных не числовой (numeric), а текстовый (character). Исправить это можно следующим образом: 
```{r}
data <- data[1:100,] # отрезает в data первые 100 наблюдений
data <- as.data.frame(as.numeric(data)) # изменяет формат данных на числовой
```
Переименуем столбец данных в соответствии с исследуемой величиной:
```{r}
names(data) <- 'Темп роста услуг' 
```
Проверим структуру исправленных данных:
```{r}
str(data)
```
Теперь все верно, поэтому переходим к статистическому анализу.

### 1.3 Дескриптивная статистика.
Самое начальное представление об исследуемой величине по нашей выборке можно получить, вызвав команду `summary` базового пакета:

```{r}
summary(data)
```
Здесь мы видим минимальное значение в выборке (`min`) равное $80,00$, выборочные нижний квартиль (`1st qu`) равный $88,00$, медиану (`median`) - $90,00$, среднюю (`mean`) - $90,11$, верхний квартиль (`3rd qu`) - $93,25$, максимальное значение в выборке (`max`) равное $99,00$.

Теперь подключаем пакет `DescTools`(Tools for Descriptive Statistics), используемый для более подробной информации о распределении изучаемого признака:

```{r}
library('DescTools')
```

А теперь применяем функцию `Desc`(Describe data): 

```{r, fig.cap = '*Рис. 1. Гистограмма, ящичковая диаграмма и кумулята исследуемой переменной, выдаваемые функцией* `Desc` *пакета* `DescTools`'}
Desc(data)
```

В результате получаем **таблицу с кратким описанием признака** и расширенную дескриптивную статистику: выборочную среднюю, выборочное СКО, коэффициент вариации и т.д.:


1) его тип (`class`) - `numeric`,

2) число пропущенных значений (`NAs` от Not Available) - в нашем случае таких нет,

3) число категорий, если признак категориальный (`levels`).

Также мы получаем расширенную дескриптивную статистику для каждого признака в датафрейме:

1) объем выборки (`length`) - $100$,

2) число и процент наблюденных значений признака, т.е. без учета пропущенных значений (`n`) - $100; 100%$,

3) число и процент пропущенных значений признака (`NAs`) - $0; 0%$,
число уникальных неповторяющихся значений признака (`unique`) - $14$,

4) число и процент нулевых значений признака (`0s`) - $0; 0%$,

5) выборочную среднюю - $90,11$,

6) доверительный интервал для средней, используя оценку среднеквадратического отклонения (`meanCI` от Confidence Interval) - $(89,19;91,03)$,

7) выборочные процентили, в том числе медиану - $2$ строка,

8) размах вариации (`range`) - $19,00$,

9) выборочное среднеквадратическое отклонение (`sd` от Standard Deviation) - $4,64$,

10) коэффициент вариации (`vcoef`) - $0,05$,

11) медиану абсолютных отклонений значений признака от медианы (`mad` от Median Absolute Deviation) - $4,45$:

$$mad(x)=Me(|x_i-Me(x)|),$$

12) интерквартильный размах (`IQR`) - $5,25$,

13) выборочные коэффициент асимметрии (`skew` от Skewness): $-0,17$ и эксцесса (`kurt` от Kurtosis), используя несмещенную оценку среднеквадратического отклонения: $-0,72$,

14) наименьшие (`lowest`) и наибольшие значения признака в выборке (`highest`) - в скобках указана частота значения, если она больше единицы.

Также функция выдает **три графика** (рис. 1):

а) гистограмму плотности и подогнанную с помощью непараметрических методов кривую плотности распределения,

б) ящичковую диаграмму (`boxplot`) - по ней также можно судить о распределении признака, схожести его с нормальным распределением, но главное ее применение - выявление наличия экстремальных значений,

в) кумуляту относительных частот.

По графику можем видеть, что распределение нормальное. Для уточнения рассмотрим следующие характеристики:. 

Для удобства дальнейшего анализа запишем данные в вектор под именем `volume`, а также создадим переменную с объемом выборки `n`: 
```{r}
volume <- data[[1]]
n <- length(volume)
```

### 1.4 Гистограмма эмпирических частот.
Построим сначала гистограмму частот. Для этого воспользуемся функцией `hist`:

```{r, fig.cap = "*Рис. 2. Гистограмма эмпирических частот темпов роста (%) валового выпуска продукции и услуг 100 предприятий, построенная с помощью базовой функции* `hist`"}
hist = hist(volume, freq = TRUE, col = 'pink',
            breaks = 'sturges',
            xlab = 'Нижняя граница интервала',
            ylab = 'Частота',
            ylim = c(0, 30),
            main = 'Гистограмма эмпирических частот')
```

Для нанесения на гистограмму частот (рис. 2) теоретической кривой нормального распределения воспользуемся функцией `lines`, которая соединяет линией точки, координаты которых переданы в функцию аргументами. 
Вектор из абсцисс мы сгенерируем функцией `seq`, первым аргументом которой необходимо передать значение левого конца отрезка, вторым — правого конца (определим их через минимум и максимум значений по выборке, немного от них отойдя), а последним аргументом — желаемое число точек (чем больше точек мы сгенерируем, тем более гладкой получится соединяющая их линия, наша теоретическая кривая):

```{r}
x_values <- seq(from = min(volume)-0.1,
                to = max(volume)+0.1,length = 1000)
```
Значения теоретической кривой нормального распределения определим по формуле:

##### $$m_{iT} = P(a_i \le X \le b_i) \cdot n = (F(b_i, \hat{\mu}, \hat{\sigma}) - F(a_i, \hat{\mu}, \hat{\sigma})) \cdot n \approx f(x_i, \hat{\mu}, \hat{\sigma}) \cdot h \cdot n,$$

где $\hat{\mu}, \hat{\sigma}$ - оценки параметров, $h$ - ширина интервала гистограммы, $f(\cdot)$ - функция плотности нормального распределения, $F(\cdot)$ - функция распределения.

Ширину интервалов определим из полученного нами ранее результата вызова функции `hist` (затем мы и сохранили результат в объекте `hist`). Объект `hist` представляет из себя список, содержащий всю основную информацию о построенной гистограмме частот, первый элемент списка — список `breaks`, который содержит границы интервалов. Шаг мы определим как разницу между вторым и первым элементами этого списка (т.е. верхней и нижней границы первого интервала):

```{r}
h = unlist(hist['breaks'])[2]-unlist(hist['breaks'])[1]
```
Вектор из значений функции плотности нормального распределения в сгенерированных точках получим, воспользовавшись функцией `dnorm`, аргументами которой являются вектор из координат точек, значение функции плотности, в которых нужно определить среднюю и стандартное отклонение совокупности (мы используем их выборочные оценки) (по умолчанию предполагается, что функция соответствует стандартному нормальному закону распределения):

```{r}
y_values <- dnorm(x_values, mean = mean(volume), 
                  sd = sd(volume))*h*n
```

Итак, нанесем теоретическую кривую нормального закона на гистограмму частот (рис. 3):

```{r, fig.cap = "*Рис. 3. Гистограмма эмпирических частот темпов роста курса акций и теоретическая кривая нормального распределения, построенные с помощью базовой функции* `hist`"}
hist = hist(volume, freq = TRUE, col = 'cyan',
            breaks = 'sturges',
            xlab = 'Нижняя граница интервала',
            ylab = 'Частота',
            ylim = c(0, 30),
            main = 'Гистограмма частот и теоретическая кривая Гаусса')
lines(x_values, y_values, col = 'brown1')

```

### 1.5 Интервальные оценки параметров нормального распределения.

Для построения доверительных интервалов используем функции пакета `DescTools`.

Зададим сначала надежность, с которой будем строить интервальные оценки параметров $\gamma = 0,99$:

```{r}
gamma = 0.99 #надежность
```

Доверительный интервал для средней вычисляется функцией `MeanCI` (CI от Confidence Interval), аргументами которой необходимо передать вектор значений наблюдений выборки, по которой строится оценка, уровень надежности (`conf.level`, по умолчанию $0,95$), если известно генеральное среднеквадратическое отклонение, то указать его значение, в противном случае, по умолчанию используется его выборочная оценка.

Предположим сначала, что нам известно значение генерального среднеквадратического отклонения СКО $\sigma(X) = 0,2$, тогда доверительный интервал для средней строится следующим образом:

```{r}
MeanCI(volume, sd = 0.2, conf.level = gamma)

```
Первое значение результата вызова функции соответствует точечной оценке средней (`mean`) – среднему арифметическому $\bar{x} = 90,11$, второе - нижней границе доверительного интервала (`lwr.ci` от lower bound of the confidence interval), третье - верхней границе интервала (`upr.ci` от upper bound of the confidence interval). Тогда при известной генеральной дисперсии интервальная оценка генеральной средней:

##### $$P(90.0585 \le \mu \le 90.1615) = 0,99$$

В случае, если генеральная дисперсия неизвестна, доверительный интервал определяем следующим образом:
```{r}
MeanCI(volume, conf.level = gamma)

```
##### $$P(88.89067 \le \mu \le 91.32933) = 0,99$$

Доверительный интервал для дисперсии можно найти, воспользовавшись функцией `VarCI`:

```{r}
VarCI(volume, conf.level = gamma) # ДИ для дисперсии
```

Получаем точечную оценку дисперсии $\hat{S}^2 = 21,55343$, нижнюю и верхнюю границу доверительного интервала для дисперсии с надежностью $0,99$:

##### $$P(15.35247 \le \sigma^2 \le 32.08219) = 0,99$$

Построение асимптотического доверительного интервала для среднеквадратического отклонения не найдено нами в пакетах R, поэтому определим границы доверительного интервала, написав код для их определения самостоятельно:

##### $$P\left(\frac{S \cdot \sqrt{2n}}{\sqrt{2n-3} + t} \le \sigma \le \frac{S \cdot \sqrt{2n}}{\sqrt{2n-3} - t}\right) = \gamma = \Phi(t)$$

Квантиль нормального распределения определим функцией `qnorm`, аргументом которой передадим $1−\varepsilon/2$, где $\varepsilon=1−\gamma$.

```{r}
sdCI <- c(sd(volume)*sqrt(2*n)/(sqrt(2*n - 3) + qnorm(1-(1-gamma)/2)), 
          sd(volume)*sqrt(2*n)/(sqrt(2*n - 3) - qnorm(1-(1-gamma)/2))) 
names(sdCI) <- c('sd_min', 'sd_max') 
sdCI
```

Таким образом, получаем асимптотический доверительный интервал для генерального среднего квадратического отклонения:

##### $$P(3.9524 \le \sigma \le 5.7292) = 0,99$$

### 1.6 Интервальные оценки вероятности (генеральной доли) биномиального распределения.

#### Задача 8 из ДКР 1:

##### Некоторый регион исследуется с точки зрения соответствия доходов его жителей прожиточному минимуму. Предполагая, что распределение числа человек с низкими доходами может быть описано биномиальным законом. Запишем условие задачи:
а) найти с надежностью $0,95$ границы, в которых будет лежать доля жителей региона с доходами ниже прожиточного минимума, если в результате выборочного обследования $11$ случайно отобранных человек выяснилось, что доходы всех превышают
прожиточный минимум;

Запишем данные условием задачи значения числа испытаний (сколько было отобрано людей), числа успехов (сколько людей с доходами выше прожиточного минимума), надежности, с которой надо определить границы доверительного интервала;

Используем функцию `BinomCI` пакета `DescTools`, указав обязательные аргументы и требуемую надежность. В случае *выборки небольшого объема* $(n < 30)$ для построения интервальной оценки вероятности используем интервал Клоппера-Пирсона. 

```{r}
n1 = 11 # число испытаний
m1 = 0 # число успехов
gamma = 0.95 # надежность
```


```{r}
BinomCI(m1, n1, conf.level = gamma, method = 'clopper-pearson') 
```
Получаем точечную оценку вероятности (`est`), нижнюю границу (`lwr.ci`) и верхнюю границу (`upr.ci`) доверительного интервала, построенного с надежностью $0,95$, для вероятности попадания автобуса с "гармошкой":

##### $$P(0 < p < 0.2849) = 0,95$$

В случае малого числа испытаний рекомендуют также использовать
интервалы Вилсона (Wilson) и Джеффриса.
```{r}
BinomCI(m1, n1, conf.level = gamma, method = 'wilson')
BinomCI(m1, n1, conf.level = gamma, method = 'jeffreys')

```
интервал Вилсона: $$P(0 < p < 0.2588) = 0,95$$

интервал Джеффриса: $$P(0 < p < 0.1999946) = 0,95$$
Видно, что полученные такими методами интервалы уже, чем построенный нами ранее интервал Клоппера-Пирсона.

В случае выборки большого объема, как для второй партии, для построения интервальной оценки вероятности часто используют нормальную аппроксимацию - интервал Вальда.

б) найти с надежностью $0,95$ границы, в которых будет лежать доля жителей региона с доходами ниже прожиточного минимума, если в результате выборочного обследования $500$ случайно отобранных человек выяснилось, что доходы $35$ из них ниже прожиточного минимума;

В нашем случае мы имеем дело с выборкой большого объема, в связи с чем будем использовать нормальную аппроксимацию (интервал Вальда).

Запишем данные условием задачи значения числа испытаний (всего участников), числа успехов (с высшим образованием), надежности, с которой надо определить границы доверительного интервала:

```{r}
n2 = 500 #количество отобранных человек
m2 = 35 #число людей с доходом ниже прожиточного минимума
gamma = 0.95 #надежность
```

Для большой выборки мы используем интервал Вальда:

```{r}
BinomCI(m2, n2, conf.level=gamma, method = 'wald')
```
##### $$P(0.04764 < p < 0.09236) = 0,95$$
Также при большом числе испытаний можно рассмотреть интервал Агрести-Коула и в нашем случае он дал интервал меньшей ширины::
```{r}
BinomCI(m2, n2, conf.level = gamma, method = 'agresti-coull')
```
##### $$P(0.05052414 < p < 0.09603279) = 0,95$$
Ширина ди по Агрести-Коулу и вальду практически не отличается, в данном случае H по вальду немного больше.